EMCC=`which emcc`

nodesockets:
	$(EMCC) test.c -lenet -L../libs -I../include -o index.js \
        --js-library ../src/library_node_sockets.js --js-library ../src/library_inet.js -O2 -s ASM_JS=1 --closure 1

inet_ntop.o: ../src/inet_ntop.c
	$(EMCC) ../src/inet_ntop.c -o ../libs/inet_ntop.o

inet_pton.o: ../src/inet_pton.c
	$(EMCC) ../src/inet_pton.c -o ../libs/inet_pton.o

test_inet1: test_inet4.c test_inet6.c ../src/library_inet.js
	$(EMCC) test_inet6.c -o test_inet6.js --js-library ../src/library_inet.js -O2 -s ASM_JS=1 --closure 1
	$(EMCC) test_inet4.c -o test_inet4.js --js-library ../src/library_inet.js -O2 -s ASM_JS=1 --closure 1

test_inet2: test_inet6.c test_inet4.c inet_ntop.o inet_pton.o
	$(EMCC) test_inet6.c ../libs/inet_ntop.o ../libs/inet_pton.o -o test_inet6.js -O2 -s ASM_JS=1 --closure 1
	$(EMCC) test_inet4.c ../libs/inet_ntop.o ../libs/inet_pton.o -o test_inet4.js -O2 -s ASM_JS=1 --closure 1

#Chrome Extension CSP doesn't allow use of eval() which is being used in code generated by closure compiler
chrome-ext:
	mkdir -p chrome/
	$(EMCC) test.c -lenet -L../libs -I../include -o chrome/index.js \
        --js-library ../src/library_node_sockets.js --js-library ../src/library_inet.js \
        -s CHROME_SOCKETS=1  -O2 -s ASM_JS=1 --closure 0 -s SOCKET_DEBUG=0
